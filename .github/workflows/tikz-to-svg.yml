name: Build TikZ to SVG

on:
  push:
    branches: [ "main" ]     # 如果你的默认分支不是 main，这里改成 master 或你的分支名
    paths:
      - "fig/*.tex"
      - ".github/workflows/tikz-to-svg.yml"
      - "README.md"
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Install TeX Live and tools
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full pdf2svg

      - name: Compile TikZ to PDF
        run: |
          mkdir -p assets
          pdflatex -shell-escape -interaction=nonstopmode -halt-on-error fig/datasets_tree.tex

      - name: Convert PDF to SVG
        run: |
          pdf2svg fig/datasets_tree.pdf assets/datasets_tree.svg

      - name: Commit SVG if changed
        run: |
          if [[ -n "$(git status --porcelain)" ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add assets/datasets_tree.svg
            git commit -m "chore(ci): auto-build TikZ SVG"
            git push
          else
            echo "No changes to commit."
          fi
